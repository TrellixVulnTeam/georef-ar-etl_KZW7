<div class="row">
    <div class="col-xs-12 col-sm-6 col-lg-6">
        <h4 style="text-align:center">HERE</h4>
        <div class="results">
            {% for result in results.here %}
                <div class="result">
                    <a data-lat="{{ result.Location.DisplayPosition.Latitude }}" data-lon="{{ result.Location.DisplayPosition.Longitude }}" href="/">
                        <div><span>{{ result.Location.Address.Label }}</span></div>
                    </a>
                    <div class="details" hidden>
                        <button class="btn btn-default btn-sm" data-result="{'source': 'here', 'address': {{ result }}}">Guardar</button>
                        <span><strong>Tipo de resultado:</strong> {{ result.MatchLevel }}</span><br>
                        <div id="map-here-{{ forloop.counter0 }}" class="map"></div>
                    </div>
                </div>
            {% empty %}
                <p style="text-align:center">No hay resultados para mostrar...</p>
            {% endfor %}
        </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-lg-6">
        <h4 style="text-align:center">Open Street Map</h4>
        <div class="results">
        {% for result in results.osm %}
            <div class="result">
                <a data-lat="{{ result.lat }}" data-lon="{{ result.lon }}" href="/">
                    <div><span>{{ result.display_name }}</span></div>
                </a>
                <div class="details" hidden>
                    <button class="btn btn-default btn-sm" data-result="{'source': 'osm', 'address': {{ result }}}">Guardar</button>
                    <span><strong>Tipo de resultado:</strong> {{ result.type }}</span><br>
                    <div id="map-osm-{{ forloop.counter0 }}" class="map"></div>
                </div>
            </div>
        {% empty %}
            <p style="text-align:center">No hay resultados para mostrar...</p>
        {% endfor %}
        </div>
    </div>
</div>

<script>
    $(".result a").click(function(e){
        e.preventDefault();
        var lat = $(this).data("lat");
        var lon = $(this).data("lon");
        if (typeof(lat) === "string") {
            lat = parseFloat(lat.replace(",", "."));
            lon = parseFloat(lon.replace(",", "."));
        }
        var mapDiv = $(this).siblings('.details').find('.map');
        if (!mapDiv.html()) {
            var map = L.map(mapDiv.attr("id")).setView([lat, lon], 15);
            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            L.marker([lat, lon]).addTo(map);
        }
        $(this).siblings(".details").toggle("fast", function() { if (map) map.invalidateSize(); });
    });
    
    $(".details button").click(function(){
        var result = $(this).data("result");
        $.post('save_address',
            { result: result, csrfmiddlewaretoken: '{{ csrf_token }}'},
            function(data) { alert(data); }
        );
    });
</script>